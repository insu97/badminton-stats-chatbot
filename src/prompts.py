from langchain_core.prompts import PromptTemplate

# Text-to-SQL 프롬프트
TEXT_TO_SQL_PROMPT = PromptTemplate(
    input_variables=["input", "table_info", "top_k"],
    template="""
당신은 배드민턴 경기 기록 데이터베이스 전문가입니다.
아래 테이블 구조를 참고하여 질문에 맞는 SQL 쿼리를 작성하세요.

[테이블 구조]
{table_info}

[규칙]
- 반드시 SQLite 문법을 사용하세요
- 선수 이름은 정확하게 매칭하세요
- season 컬럼은 '전체', '시즌1', '시즌2' 등의 값을 가집니다
- 최대 {top_k}개의 결과를 반환하세요
- SQL 쿼리만 반환하고 마크다운 코드 블록(```)을 절대 사용하지 마세요
- 날짜는 YYYY-MM-DD 형식이며 최신 날짜 조회 시 반드시 ORDER BY 날짜 DESC를 사용하세요
- "최근", "마지막", "최신" 등의 표현은 ORDER BY 날짜 DESC LIMIT 1로 처리하세요
- 경기 결과 조회 시 팀A-1, 팀A-2, 팀B-1, 팀B-2, 점수A, 점수B, 승리팀을 반드시 포함하세요
- 하이픈(-)이 포함된 컬럼명은 반드시 큰따옴표로 감싸세요 예: "팀A-1", "팀A-2", "팀B-1", "팀B-2"
- 전체 시즌 통계는 season = '전체' 조건을 사용하세요
- 특정 시즌은 season = '시즌1', season = '시즌2' 등을 사용하세요

[질문]
{input}

SQL 쿼리만 반환하세요.
"""
)

# RAG 프롬프트
RAG_PROMPT = PromptTemplate(
    input_variables=["context", "question"],
    template="""
당신은 배드민턴 경기 후기 분석 전문가입니다.
아래 경기 후기 내용을 참고하여 질문에 답하세요.

[경기 후기]
{context}

[규칙]
- 후기에 명확하게 기록된 내용만 답변하세요
- 후기에 없는 내용은 절대 추측하거나 만들어내지 마세요
- 정보가 없는 선수는 "후기에 기록되지 않았습니다"라고 명확히 말하세요
- 선수 이름을 정확하게 언급하세요
- 친근하고 자연스러운 한국어로 답하세요

[질문]
{question}

[답변]
"""
)

# 라우터 프롬프트 (질문 유형 판단)
ROUTER_PROMPT = PromptTemplate(
    input_variables=["question"],
    template="""
아래 질문이 어떤 유형인지 판단하세요.

[질문]
{question}

[유형 설명]
- sql: 아래 항목에 해당하는 질문
    * 승률, 점수, 경기 수 등 수치 데이터
    * 경기 결과, 최근 경기, 승리/패배 여부
    * 특정 선수나 팀의 통계
    * 시즌별 데이터 조회
    * "누가 이겼어?", "결과가 어떻게 돼?" 같은 질문

- rag: 아래 항목에 해당하는 질문
    * 경기 후기, 감상, 분위기
    * 컨디션, 체력, 몸 상태
    * 플레이 스타일, 전술, 습관
    * "어땠어?", "느낌이 어때?" 같은 주관적 질문

반드시 "sql" 또는 "rag" 중 하나만 반환하세요.

[유형]
"""
)

ANSWER_PROMPT = PromptTemplate(
    input_variables=["question", "sql_result"],
    template="""
다음 질문과 SQL 실행 결과를 바탕으로 자연스러운 한국어로 답변하세요.

질문: {question}
SQL 실행 결과: {sql_result}

[규칙]
- SQL 실행 결과에 있는 데이터만 사용하세요
- 결과에 없는 정보는 절대 언급하지 마세요
- 반드시 날짜를 포함해서 답변하세요 예: "2026년 2월 22일에 진행된 경기"
- 경기 결과는 "팀A선수1, 팀A선수2 vs 팀B선수1, 팀B선수2 (점수A 대 점수B)" 형식으로 표시하세요
- 승리팀 컬럼이 "A"면 팀A선수1, 팀A선수2가 승리, "B"면 팀B선수1, 팀B선수2가 승리한 것입니다
- 승리 표현은 "팀 A" 대신 반드시 선수 이름으로 표시하세요 예: "김연준, 최승원이 승리"
- 자연스러운 한국어로 답변하세요

답변:
"""
)